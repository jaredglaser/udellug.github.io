<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Linux Users Group @ UD</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Staatliches" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
  </head>

  <body>
      <script type='text/javascript' src='config.js'></script>
      <script>

      var clientId = config.CLIENT_ID;
      var apiKey = config.API_KEY;
      var userEmail = config.CALENDAR;
      var userTimeZone = "New_York";
      var maxRows = 2;
      var calName = "test";

      var scopes = 'https://www.googleapis.com/auth/calendar';

      function padNum(num) {
          if (num <= 9) {
              return "0" + num;
          }
          return num;
      }

      function AmPm(num) {
          if (num <= 12) { return "am " + num; }
          return "pm " + padNum(num - 12);
      }

      function monthString(num) {
               if (num === "01") { return "JAN"; }
          else if (num === "02") { return "FEB"; }
          else if (num === "03") { return "MAR"; }
          else if (num === "04") { return "APR"; }
          else if (num === "05") { return "MAJ"; }
          else if (num === "06") { return "JUN"; }
          else if (num === "07") { return "JUL"; }
          else if (num === "08") { return "AUG"; }
          else if (num === "09") { return "SEP"; }
          else if (num === "10") { return "OCT"; }
          else if (num === "11") { return "NOV"; }
          else if (num === "12") { return "DEC"; }
      }

      function dayString(num){
               if (num == "1") { return "Monday" }
          else if (num == "2") { return "Tuesday" }
          else if (num == "3") { return "Wednesday" }
          else if (num == "4") { return "Thursday" }
          else if (num == "5") { return "Friday" }
          else if (num == "6") { return "Saturday" }
          else if (num == "0") { return "Sunday" }
      }

      function handleClientLoad() {
          gapi.client.setApiKey(apiKey);
          checkAuth();
      }

      function checkAuth() {
          gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: true}, handleAuthResult);
      }

      function handleAuthResult(authResult) {
          if (authResult) {
              makeApiCall();
          }
      }

      function makeApiCall() {
          var today = new Date(); //today date
          gapi.client.load('calendar', 'v3', function () {
              var request = gapi.client.calendar.events.list({
                  'calendarId' : userEmail,
                  'timeZone' : userTimeZone,
                  'singleEvents': true,
                  'timeMin': today.toISOString(), //gathers only events not happened yet
                  'maxResults': maxRows,
                  'orderBy': 'startTime'});
          request.execute(function (resp) {
                  for (var i = 0; i < resp.items.length; i++) {
                      var li = document.createElement('li');
                      var item = resp.items[i];
                      var classes = [];
                      var allDay = item.start.date? true : false;
                      var startDT = allDay ? item.start.date : item.start.dateTime;
                      var dateTime = startDT.split("T"); //split date from time
                      var date = dateTime[0].split("-"); //split yyyy mm dd
                      var startYear = date[0];
                      var startMonth = monthString(date[1]);
                      var startDay = date[2];
                      var startDateISO = new Date(startMonth + " " + startDay + ", " + startYear + " 00:00:00");
                      var startDayWeek = dayString(startDateISO.getDay());
                      if( allDay == true){
                          var str = [
                          '<span class="event">',
                          item.summary, '<span class="event-info">',
                          startDayWeek, ' ',
                          startMonth, ' ',
                          startDay, ' ',
                          startYear,
                          '</span></span>'
                          ];
                      }
                      else{
                          var time = dateTime[1].split(":"); //split hh ss etc...
                          var startHour = time[0];
                          var startMin = time[1];
                          var str = [ 
                              '<span class="event">',
                              item.summary, '<span class="event-info">',
                              startDayWeek, ' ',
                              startMonth, ' ',
                              startDay, ', ',
                              startYear, ' - ',
                              startHour, ':', startMin,
                              '</span></span>'
                              ];
                      }
                      li.innerHTML = str.join('');
                      li.setAttribute('class', classes.join(' '));
                      document.getElementById('calendar').appendChild(li);
                  }
              });
          });
      }
      //--------------------- end
      </script>
      <script src='https://apis.google.com/js/client.js?onload=handleClientLoad'></script>

    <div>
      <div class="title">
        <h1 class="name">
          UDEL Linux Users Group
        </h1>
      </div>
      <h2>Upcoming Events:</h2>
      <div id="calendar"></div>
      <div class="footer">
        <div class="links">
          <a href="https://github.com/crclark96/" target="_blank">
            Github
          </a>
          <a href="mailto:crclark96@gmail.com" target="_blank">
            Slack
          </a>
          <a href="./resume.pdf" target="_blank">
            About
          </a>
        </div>
      </div>
    </div>

  </body>
